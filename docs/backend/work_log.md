## 작업 로그 (2025-12-03)
- 계획: BuyerPortal 탭 전환 시 DefaultTabController null 오류 방지 및 MockOrderRepository의 API 삭제 경로 검증
- 실행: `lib/ui/pages/buyer/buyer_portal_page.dart`에서 `_navigateToTab` 호출 전에 `DefaultTabController` 존재 여부를 확인하도록 수정하고, `lib/repositories/mock_repository.dart`의 `MockOrderRepository.delete`가 `/orders/{id}` 엔드포인트를 호출하도록 정정
- 결과: BuyerPortal 탭 이동 시 Null 오류를 예방하여 UX 지침을 준수하고 로컬 API 기반 주문 삭제 흐름이 올바른 경로를 사용하도록 정상화됨

## 작업 로그 (2025-12-03-2)
- 계획: BuyerPortal 지난 주문 카드에 “N개 품목 : 총수량 M” 요약을 노출하기 위해 주문 API/모델에 lineCount 정보를 추가
- 실행: `server/src/modules/orders/controller.ts`에서 주문 목록 조회 시 `line_count`를 반환하고 상세 응답에도 반영, Flutter `Order` 모델(`lib/models/order.dart`)과 관련 매퍼(`lib/repositories/order_repository.dart`, `lib/repositories/mock_repository.dart`)를 lineCount 필드를 지원하도록 확장, BuyerPortal 카드(`lib/ui/pages/buyer/buyer_portal_page.dart`)에서 `buyerOrderSummary` 문자열을 사용해 요약 표시
- 결과: API/클라이언트가 모두 품목 수와 총수량을 제공·표시하게 되어 BuyerPortal UX 가이드의 요구사항을 충족하며 재주문 시 참고 정보가 강화됨

## 작업 로그 (2025-12-03-3)
- 계획: 회원가입 다이얼로그에서 남아 있던 개별 SnackBar 알림을 AppSnackbar로 통합하고 메시지를 자연스러운 한국어로 정비
- 실행: `lib/ui/pages/auth/sign_in_page.dart`의 `messenger?.showSnackBar` 호출을 모두 `AppSnackbar.show`로 대체하고, 이메일 중복 확인/판매자 선택/제출 결과 등의 안내 문구를 AppSnackbar를 통해 노출되도록 수정
- 결과: 회원가입 오류/안내 알림이 공통 스타일(AppSnackbar)로 일관되게 표시되어 UX 지침을 충족하며, 번역도 자연스러운 한글 문장으로 정비됨

## 작업 로그 (2025-12-03-4)
- 계획: 비밀번호 재설정/프로필 수정 등 남은 SnackBar 호출을 모두 AppSnackbar로 교체
- 실행: `lib/ui/pages/auth/sign_in_page.dart`의 `_showSnack` 헬퍼를 AppSnackbar 사용으로 변경해 비밀번호 재설정/탐색 메시지가 통합되도록 하고, `lib/ui/pages/profile/profile_modal.dart` 저장 알림도 AppSnackbar로 교체
- 결과: 앱 전반에서 `ScaffoldMessenger.showSnackBar` 직접 호출이 제거되어 알림 스타일이 통일되었고, 추가 번역 문자열도 자연스러운 한국어로 정리됨

## 작업 로그 (2025-12-03-5)
- 계획: 모든 알림을 NotificationTicker 기반 실시간 알림으로 통일하고 AppSnackbar 유틸 제거
- 실행: `lib/ui/pages/auth/sign_in_page.dart`와 `lib/ui/pages/profile/profile_modal.dart`의 `AppSnackbar` 호출을 `NotificationTicker.push`로 교체하고, `_showSnack` 헬퍼를 NotificationTicker 사용으로 변경, 마지막으로 `lib/ui/widgets/app_snackbar.dart` 파일 삭제
- 결과: 앱 전체 알림이 NotificationTicker 영역 하나로 통합되어 중복 토스트 UI가 사라졌고, 유지보수가 단순해짐

## 작업 로그 (2025-12-04-10)
- 계획: 도매 고객 목록에서 신규 소매사가 연결되면 해당 업체에 종속된 데이터를 매장 카드로 단순하게 보여주도록 정리
- 실행: `server/src/modules/customers/controller.ts`에서 고객 자료 동기화 시 신규 소매/도매 연결이 완료되면 스토어 카드가 즉시 생성되도록 로직을 보강하고 BuyerPortal/권한 체크 로직에 반영
- 결과: 도매 관리자에게 고객 검색/승인 흐름이 즉시 반영되어 구매자 측과 데이터를 공유할 수 있음

## 작업 로그 (2025-12-04-11)
- 계획: 결제/정산 관련 화면에서 필수 항목 누락 시 오류 메시지가 사용자에게 분명히 안내되도록 UI/서버 합동 개선
- 실행: `server/src/modules/auth/controller.ts`의 `/auth/buyer/reapply` 입력 검증을 강화하고, `ApiAuthService·AuthController`가 서버 응답 메시지를 전달하도록 갱신, SettingsPage에 프로필 카드·구매자 미리보기 카드·로그아웃 버튼을 재배치
- 결과: 소매/도매 선택·매장 관리 화면에서 필수 정보 누락 시 즉시 안내되며, 서버/클라이언트 전반에 정합성 체크가 반영됨

## 작업 로그 (2025-12-04-12)
- 계획: 구배포/개인·언어 설정을 손쉽게 모바일/태블릿 오류와 경고를 제거하고, 앱 설정 화면 UI를 간소화
- 실행: BuyerPortal 그리드/오버레이에서 경계선을 정리하고, SettingsPage에서 프로필 카드/구매자 미리보기·언어 선택/로그아웃 버튼을 카드 레이아웃으로 구성, 모바일/태블릿에서도 정렬이 유지되도록 구성
- 결과: 설정 화면이 한눈에 들어오며, 오버레이 분리 덕분에 Section별 위치가 명확해짐

## 작업 로그 (2025-12-04-13)
- 계획: 도매 결제 기반 흐름에서 신규 소매 등록시 우선순위가 반영되도록 하고, 소매가 승인되면 판매자/소매 데이터를 공유할 수 있게 로직 보강
- 실행: POST `/auth/register-buyer`가 기존 소매 업체 등록을 지원하고, `/auth/buyer/reapply` 경로에서 소매-판매자 관계를 재검증하도록 변경. BuyerPortal에서 신규요청을 같은 컨트롤러/화면에서 제출하도록 수정.
- 결과: 신규 소매 회사가 API 단에서 소유자/관리자 역할을 자동 획득하고, 서버 측에서 중복/권한 검사 후 바로 반영되도록 정리됨

## 작업 로그 (2025-12-04-14)
- 계획: BuyerPortal에서 “No active wholesaler connections”가 계속 뜨는 현상과 lint 경고(use_build_context_synchronously 등)를 해소
- 실행: `server/src/modules/admin/controller.ts`에서 연결 요청이 승인되면 소매 측 memberships와 seller memberships에 owner 권한이 포함되도록 보강하고, Flutter 코드에서 mounted/context.mounted 체크를 추가. 주문 모델/리포지토리의 `lineCount` 게터를 정리하고 lint 경고를 제거.
- 결과: 소매 사용자가 도매에서 승인되면 BuyerPortal 화면에 즉시 연결이 반영되고, analyzer 경고가 대부분 해소됨

## 작업 로그 (2025-12-04-15)
- 계획: 구매자/도매 회사 구성이 모두 동일 주문 내역을 공유하고, 주문 상세에서 담당자 정보를 확인할 수 있도록 개선
- 실행: orders 테이블에 `buyer_tenant_id/buyer_user_id/buyer_user_name/buyer_user_email` 컬럼을 추가하고, `/orders` API 응답에서 해당 정보를 반환하도록 변경. Flutter `Order` 모델과 UI를 모두 업데이트해 주문 복사/대시보드 카드에서 담당자 이름과 메모를 표시.
- 결과: 회사 구성원 누구나 동일한 주문 데이터를 공유하고, 주문 상세와 대시보드에서 주문자 정보가 보이도록 일원화됨

## 작업 로그 (2025-12-04-16)
- 계획: BuyerPortal 방문형·개인 설정·언어 토글 선호도 동기화를 정리하고, 서버/클라이언트 전반에 대표자/기본 매장 지정 기능을 추가
- 실행: BuyerPortal 그리드/오버레이 여백 로직을 손본 모바일·태블릿 오류 경고를 제거하고, 앱 설정에 “프로필·개인 설정” 카드와 “매장 설정” 섹션을 추가. 설정 화면에서 매장 목록·언어·로그아웃을 카드 하나로 묶고, 기본 매장은 AuthController/ApiAuthService에서 저장하도록 구현.
- 결과: 도매 사용자/소매 사용자가 모두 설정 화면에서 매장 정보를 직접 관리하고 기본 매장을 지정할 수 있으며, 변경 사항이 저장되면 전체 앱에 즉시 반영됨

## 작업 로그 (2025-12-04-17)
- 계획: BuyerPortal 주문서에서 매장 선택을 자동으로 기본값으로 채우고, 프로필/설정 메뉴를 “개인정보”로 단순화하며, 설정 화면의 불필요한 항목을 제거
- 실행: `buyer_portal_page.dart`에서 주문 로딩 완료 시 `_selectedStore`로 이전 선택을 복원하고, `BuyerMenuProfile`를 “개인설정”으로 갱신. SettingsPage에서 프로필 카드·구매자 미리보기 카드·로그아웃 버튼을 삭제하고 필요한 섹션만 남김.
- 결과: 장바구니/주문 제출 시 항상 기본 매장이 선택된 상태로 시작하며, 프로필 및 설정 화면도 간결한 UX로 정돈됨

## 작업 로그 (2025-12-04-18)
- 계획: BuyerPortal 반응형/개인·언어 설정·업체 설정 동기화를 정비하고, 서버/클라이언트 전반에 대표자/기본 매장 토글을 추가
- 실행: BuyerPortal 그리드/오버레이/탭 로직을 손봐 모바일·태블릿 오류 경고를 제거하고, 개인 설정 화면에서 로컬라이즈된 이름/직원 분류/연락처를 편집하도록 수정. Buyer Settings 섹션을 언어/업체/연결 카드로 분리하고, `auth/tenants` 응답에 representative/isPrimary 필드를 포함시켜 primaryTenantId·언어 설정을 저장.
- 결과: 소매/도매 구분 없이 설정 화면에서 업체 정보를 직접 관리하고 기본 매장을 지정할 수 있으며, 서버/앱 전반에서 저장된 선호도와 언어가 유지됨

## 작업 로그 (2025-12-04-19)
- 계획: BuyerPortal 설정·개인 설정/업체 설정 탭에서 네비게이션이 사라지는 문제와 장바구니/주문서 전환 애니메이션 오류를 해결
- 실행: `buyer_portal_page.dart`에서 헤더/탭을 유지한 채 설정·개인설정 페이지를 표시하도록 Navigator 구조를 조정하고, `settings_page.dart`에서 프로필 카드/업체 카드/로그아웃 버튼을 AppBar 밑으로 이동. 언어 버튼과 로그인 메뉴를 동일한 AppBar 메뉴에서 노출하도록 정리.
- 결과: 개인 설정·설정 페이지에서도 상단 네비게이션이 유지되고, 소매 사용자 경험이 일관성을 되찾음

## 작업 로그 (2025-12-04-20)
- 계획: 소매/도매 각각 회사/직원 정보를 공유하고 대표/관리자가 직책을 지정하며, 대기 요청/로그아웃 버튼이 사라진 문제를 해결
- 실행: `server/src/modules/auth/controller.ts`에서 구성원 목록과 역할 업데이트 API를 추가하고, `vendorjet/lib/services/auth/*.dart`와 SettingsPage에 구성원 목록/직책 편집/로그아웃 버튼을 배치해 매장/업체 카드를 선택/삭제할 수 있도록 보강
- 결과: 새로 가입한 직원도 즉시 기존 도매/소매 연결을 공유하며, 오너는 설정 화면에서 구성원 직책을 조정하고 자신의 직책을 확인할 수 있음

## 작업 로그 (2025-12-04-21)
- 계획: 도매 설정 화면에서 매장 전환·구성원 정보·로그아웃 버튼이 사라진 문제와 BuyerPortal 주문서 오류를 동시에 해결
- 실행: SettingsPage에 매장/업체 카드와 전환 버튼을 복구하고 구성원 API에 전달한 이메일·연락처를 모두 보여주도록 보강, 로그아웃 버튼을 추가. BuyerPortal에서 “주문서로 불러오기” 버튼이 Provider 컨텍스트 밖에서 Cart를 참조하던 문제를 cart 인스턴스 전달 방식으로 수정.
- 결과: 도매 사용자는 설정 화면에서 여러 매장을 명확히 선택·관리하고, 소매 측 주문서 불러오기 시 Provider 오류가 발생하지 않음

## 작업 로그 (2025-12-08-01)
- 계획: SettingsPage에서 `_StoreTile` 위젯 정의가 누락되어 발생한 다트 분석 오류 37건을 해결해 앱이 다시 빌드될 수 있도록 한다.
- 실행: `_buildStoreSelector` 내부에 잘못 위치했던 `_StoreTile` 선언을 제거하고, `_SettingsPageState` 클래스 외부 하단에 전용 위젯으로 재정의해 재사용 UI를 복구했다. 수정 후 `dart analyze lib/ui/pages/settings_page.dart`를 실행해 오류 여부를 확인했다.
- 결과: `_StoreTile` 관련 컴파일 오류가 모두 사라졌고, SettingsPage가 정상적으로 컴파일된다(use_build_context_synchronously 권고만 잔존). Analyzer 결과는 정보 메시지 3건만 남았다.

## 작업 로그 (2025-12-08-02)
- 계획: 도매 업체 검색 시 중복 노출과 소매 연결 재요청 오류를 해소하고, Settings 화면에서 사용자 매장 정보가 항상 표시되도록 서버/클라이언트를 정비한다.
- 실행: `/auth/tenants-public` 쿼리에 `SELECT DISTINCT`를 적용하고, 클라이언트에서도 이름/전화/주소 조합 기준으로 중복을 제거했다. `ApiAuthService.fetchTenants`가 `tenant_type`·`is_primary` 필드를 모두 파싱하도록 보강했으며, SettingsPage의 재연결 폼에서 업태/분류 필수 검증을 추가했다.
- 결과: 도매 검색 팝업에 중복 항목이 나타나지 않고, 각 사용자 계정에서 내 매장 정보가 정상적으로 노출된다. 소매 재연결 시 필수 값 누락으로 인한 서버 400 오류도 사전에 차단됐다.

## 작업 로그 (2025-12-08-03)
- 계획: 도매 Settings 화면의 구성원 목록에서 연결된 소매 사용자까지 노출되는 문제를 해결해 도매/소매 권한을 명확히 분리한다.
- 실행: `/auth/members` API가 테넌트의 유형(도매/소매)을 계산한 뒤, 해당 유형과 일치하는 `user_type`을 가진 사용자만 반환하도록 필터링 로직을 추가했다. 이로써 도매 테넌트는 `wholesale` 사용자만, 소매 테넌트는 `retail` 사용자만 목록에 포함된다.
- 결과: 도매 Settings 페이지에서는 자사 직원만 구성원으로 보여지고, 연결된 소매 업체는 고객 관리 화면에서만 확인할 수 있게 되어 권한 구분이 명확해졌다.

## 작업 로그 (2025-12-08-04)
- 계획: 신규 업체/매장 추가 시 기존 직원이 자동으로 접근권을 얻지 않도록 “사장 승인 기반” 정책(1안)을 적용하고, 소매 승인 시 생성되던 교차 멤버십을 제거한다.
- 실행: `/auth/register-buyer`와 `/admin/requests/:id`에서 소매 사용자에게 도매 테넌트 멤버십을 자동 부여하던 로직과 싱크 함수를 삭제하고, 연결 승인 시에는 고객/세그먼트 데이터만 갱신하도록 조정했다.
- 결과: 새로 등록된 업체는 소유자만 접근할 수 있으며, 직원은 초대/승인을 거쳐야 한다. 도매·소매 계정이 서로의 테넌트에 자동 가입하지 않아 권한 경계가 명확해졌다.

## 작업 로그 (2025-12-08-05)
- 계획: 소매 사용자가 연결된 여러 도매 업체 중 원하는 업체를 선택해 전환하고, 주문/상품 목록을 해당 업체 기준으로 불러올 수 있도록 BuyerPortal·Settings UI를 확장한다.
- 실행: Settings의 “연결된 도매업체” 목록을 ChoiceChip으로 바꿔 선택 시 `switchTenant`를 호출하도록 했고, BuyerPortal AppBar에 도매 선택 드롭다운을 추가했다. 선택/전환 시 `AuthController.switchTenant`를 호출해 API 클라이언트의 tenantId를 바꾸고, 상품/주문/매장 목록을 다시 불러오도록 `_ensureActiveSellerTenant`/`_switchSellerTenant` 헬퍼를 구현했다.
- 결과: 소매 사용자는 승인된 도매 업체들을 목록에서 즉시 선택해 전환할 수 있으며, 전환 후 해당 도매의 카탈로그와 주문 내역이 로드된다. 도매별 오더링 시나리오를 한 화면에서 처리할 수 있게 되었다.

## 작업 로그 (2025-12-08-06)
- 계획: 도매와 이미 연결된 소매 계정이 추가 연결 요청을 보낼 때 Settings 하단 시트에서 `_dependents.isEmpty` assertion이 발생하는 문제를 해결한다.
- 실행: `SettingsPage._openBuyerReconnectSheet`에서 임의로 추출해 사용하던 `rootNavigator.context` 대신, 기존 페이지 `context`에 `useRootNavigator: true` 옵션만 부여해 모달을 호출하도록 수정했다. 이로써 Provider 의존성이 올바른 위계에 유지되고, 시트 종료 시 불필요한 컨텍스트 해제가 발생하지 않도록 했다.
- 결과: 이미 도매에 연결된 상태에서도 추가 연결 요청 시트가 안정적으로 열리고 닫히며, 요청 완료 후 더 이상 붉은 화면(assertion)이 나타나지 않는다.

## 작업 로그 (2025-12-08-07)
- 계획: 소매 재연결 흐름에서 이미 연결/승인 대기 중인 도매에 중복 요청을 보내면 409 오류만 표시되는 문제를 해결하고, 다중 도매 연결 목록/전환 UI와 대시보드 협소 화면 레이아웃을 보강한다.
- 실행: 서버 `auth/controller`의 `/auth/buyer/reapply`에 구매사 세그먼트 필수 검증, 회사 단위 중복 연결/대기 검사, 대표자/연락처/도매 연락처 저장 로직을 추가하고, 클라이언트 `ApiAuthService`가 새로운 오류 메시지를 분기 처리하도록 수정했다. Settings의 “연결된 도매업체” 카드에 Chips+리스트를 함께 보여주고 전환 버튼을 추가했으며, 관련 다국어 문자열을 보강하고 `flutter gen-l10n`을 재실행했다. 대시보드 지표 그리드를 화면 폭 기준으로 높이를 재계산하도록 수정해 277px/790px 이하에서 발생하던 overflow를 제거했다.
- 결과: 이미 연결된 도매나 승인 대기 중인 업체에는 재요청이 차단되고 사용자에게 명확한 안내가 표시되며, 여러 도매 연결을 카드/드롭다운 양쪽에서 확인·선택할 수 있다. 협소 폭에서도 대시보드 카드가 더 이상 붉은 overflow 경고를 띄우지 않는다.

## 작업 로그 (2025-12-08-08)
- 계획: 개발 DB를 초기화해 admin 계정과 Acme/Nova 두 도매만 남기고 주문·회원 기록을 모두 삭제하며, 웹 뷰포트 최소 너비 가드를 추가하고 Settings 구성원 카드에서 액션 버튼으로 인한 overflow를 제거한다.
- 실행: `server/vendorjet.db`에서 admin 외 모든 사용자와 memberships, 고객/주문/요청/상품 테이블을 비우고, admin을 Acme/Nova의 단일 대표로 재지정했다. Flutter `main.dart`에 최소 360px 가드와 안내 메시지를 추가해 지나치게 좁은 브라우저에서는 경고 화면을 표시하도록 했고, Settings 구성원 타일의 역할 드롭다운/제목 편집 버튼을 subtitle 영역으로 옮겨 세로 overflow가 발생하지 않도록 재배치했다. 관련 다국어 문자열을 보강 후 `flutter gen-l10n`과 `flutter analyze`로 검증했다.
- 결과: 서버에는 admin + 두 도매만 남고 모든 주문·회원 이력이 제거됐다. 브라우저 폭을 360px 아래로 줄이면 안내 화면이 표시되어 레이아웃 붕괴를 방지하며, 구성원 목록에서도 추가 메뉴(햄버거)로 인한 overflow 경고가 더는 나타나지 않는다.

## 작업 로그 (2025-12-08-09)
- 계획: BuyerPortal의 연결 상태/설정 UX와 승인 흐름을 보강하고, 직책을 공통 목록으로 관리하도록 서버·클라이언트 전반을 개편한다.
- 실행: `/auth/buyer/reapply`에 소매 대표 권한 검증·회사 단위 중복 체크를 강화하고, 승인 시에는 멤버십만 부여하고 요청 레코드는 즉시 삭제하도록 서버 로직을 수정했다. 새 직책 테이블(`tenant_positions`)과 CRUD/할당 API를 추가하고, Settings 페이지에 직책 목록/등록/삭제 UI와 구성원별 직책 드롭다운을 구현했으며 기존 커스텀 타이틀 로직을 모두 교체했다. BuyerPortal 앱바는 단일 설정 버튼으로 단순화하고, 오버레이 상단에 설정·개인설정·로그아웃 메뉴와 뒤로가기를 배치했으며, 연결 미완료/대기 상황에 따라 단일 안내 문구만 노출하도록 모든 탭의 메시지를 정리했다. 신규 문자열 번역을 추가해 `flutter gen-l10n`, `npm run build`, `flutter analyze`를 다시 실행했다.
- 결과: 소매 대표만 도매 연결 요청을 보낼 수 있고, 승인 결과는 즉시 도매 멤버십으로만 반영된다. 직책을 공통 목록으로 등록·수정·삭제한 뒤 구성원에게 지정할 수 있어 직책 관리가 일관되며, BuyerPortal에서도 설정 UI가 명확해지고 연결 상태 안내가 실제 상황(대기/미연결)에 맞게 표시된다.

## 작업 로그 (2025-12-10-01)
- 계획: 소매 계정이 두 번째 도매 연결을 요청할 때 `_dependents.isEmpty` assertion이 다시 발생하는 문제를 재발 방지 구조로 해결한다.
- 실행: `SettingsPage._openBuyerReconnectSheet`를 전면 리팩터링해 모달 내부 상태/컨트롤러를 `_BuyerReconnectSheet` 위젯에 위임하고, 호출부는 데이터만 전달하도록 단순화했다. 새 위젯 내부에서 로컬 컨텍스트를 사용해 다이얼로그/폼을 구성하고 성공 시 선택한 도매명을 반환하게 구현했다.
- 결과: 하단 시트가 독립적으로 상태를 관리하면서 Provider 종속성이 꼬이지 않아 assertion 없이 안정적으로 동작하고, 도매 요청 성공 시 알림/대기 상태가 즉시 반영된다.

## 작업 로그 (2025-12-10-02)
- 계획: 동일 도매에 이미 연결되어 있거나 대기 중일 때 409 Conflict가 발생하면 사용자에게 한국어 안내를 제공하고, Pending 상태를 곧바로 화면에 반영한다.
- 실행: `ApiAuthService`/`AuthController`에 `BuyerReconnectResult` 모델을 도입해 API 응답/오류 메시지를 그대로 전달하고, 409(중복/대기) 상황을 구분하도록 했다. Buyer Settings 시트에서는 해당 결과에 따라 `buyerSettingsRequestAlreadyPending`/`buyerSettingsRequestAlreadyConnected` 문구를 노출하면서 모달을 닫고, l10n ARB·생성 파일을 업데이트했다.
- 결과: 이미 대기 중인 연결이라면 “승인 대기 중” 메시지가 즉시 나타나며, 요청 버튼을 반복해도 빨간 화면이나 모호한 오류가 발생하지 않는다.

## 작업 로그 (2025-12-10-03)
- 계획: 도매 추가 요청 전에 연결/대기 상태를 선제적으로 차단하고, 둘 이상의 도매가 승인되면 구매자가 원하는 도매를 자유롭게 전환할 수 있도록 기본 도매 설정 UI/로직을 확장한다. 또한 관리자가 연결을 승인하면 실제 membership이 생성되어 클라이언트에서 여러 도매를 조회할 수 있어야 한다.
- 실행: Settings의 연결 요청 시트가 선택한 도매가 기존 연결/대기 상태인지 즉시 검사하도록 `connectedSellerIds`/`pendingSellerName` 정보를 전달하고, 동일 업체면 버튼이 비활성화되며 경고 문구를 표기하도록 리팩터링했다. 동시에 `AuthController`에 `activeSellerTenantId`를 도입해 선호 도매를 추적하고, BuyerPortal/Settings 어디에서든 드롭다운과 ChoiceChip으로 기본 도매를 바꾸면 자동으로 카탈로그/주문 데이터가 해당 도매로 전환되도록 `_ensureActiveSellerTenant`와 Settings UI를 보강했다. 서버 `admin` 요청 승인 로직에서는 buyer request가 승인될 때 해당 사용자에게 판매자 테넌트 membership을 생성하도록 추가했다.
- 결과: 이미 연결된 도매는 요청 단계에서 차단돼 409 에러가 발생하지 않으며, 승인된 도매가 여러 개일 때 기본 도매 선택 UI와 BuyerPortal 상단 드롭다운이 연동돼 즉시 전환/재로딩이 이뤄진다. 관리자 승인 후 membership이 자동 생성되어 두 번째 도매도 목록/드롭다운에 노출된다.

## 작업 로그 (2025-12-10-04)
- 계획: 대표가 직접 구성원의 맞춤 직책을 생성·관리하고, UI에서 해당 직책을 확인/편집할 수 있게 한다. 동시에 회원가입 필수 항목 검증과 협업 정책을 명시한다.
- 실행: 서버에 `member_positions` 테이블과 `/auth/member-positions/:memberId` API를 추가해 owner만 맞춤 직책을 설정·삭제할 수 있도록 했다. `/auth/members` 응답에 customTitle을 포함하고, Flutter `TenantMemberDetail`/Settings UI에 직책 표시 및 편집 다이얼로그를 추가했다. 다이얼로그에서 입력한 텍스트를 저장하면 NotificationTicker로 결과를 안내한다.
- 결과: 대표가 관리자/기사 등 직책을 자유롭게 만들고 구성원별로 지정할 수 있으며, Settings > 구성원 섹션에서 직책을 확인하고 즉시 수정할 수 있다. 요구사항에 서술한 “대표가 공유하려는 업체와 직원을 선택” 기능 중 직책 관리 파트가 구현되었다.

## 작업 로그 (2025-12-10-05)
- 계획: Settings 포지션 리스트가 테넌트 전환 시 즉시 갱신되도록 하고, BuyerPortal 오버레이 칩 상태와 누락된 다국어 문자열·DB 스키마를 정비한다.
- 실행: `settings_page.dart`에서 구성원 로딩 시 직책 목록을 강제 새로고침/정렬하도록 고치고, 새 테넌트 전환 및 편집/삭제 후 `_positionsByTenant` 캐시를 재갱신하게 수정했다. `buyer_portal_page.dart` 오버레이 ChoiceChip에는 현재 선택 상태를 감지하는 가드를 추가했다. `app_en.arb`·`app_ko.arb` 번역을 보완해 `flutter gen-l10n`으로 생성 파일을 갱신했으며, `server/schema.sql`에 `tenant_positions`·`member_positions` 정의를 포함시켰다.
- 결과: 테넌트를 바꿀 때마다 최신 직책 목록이 즉시 반영되고 정렬 일관성이 유지된다. 구매자 설정 오버레이 전환 시 불필요한 재빌드가 줄어 UX가 안정됐으며, 모든 새 문자열이 영/한 모두 번역돼 빌드 경고가 사라졌다. 신규 DB 인스턴스도 직책 테이블을 바로 포함해 서버-클라이언트 기능이 동작한다.

## 작업 로그 (2025-12-10-06)
- 계획: BuyerPortal 헤더 구조 요구사항 반영(설정 진입 시 상단 메뉴 대체) 및 구성원 직책 관련 한국어 번역 복구.
- 실행: AppBar 하단을 상황에 따라 TabBar 또는 설정 메뉴 바로 전환하도록 수정하고, 설정 진입 시 헤더 메뉴에서 설정/개인설정/로그아웃을 노출하도록 `_SettingsMenuBar` 위젯을 추가했다. 기존 오버레이 상단 행은 제거하고, 설정 아이콘을 토글(열기/닫기)로 동작하게 바꿨다. `app_ko.arb`의 직책·구매자 정보 등 `??`로 깨졌던 문자열을 모두 한글로 복원하고 `flutter gen-l10n`으로 생성 파일을 갱신했다.
- 결과: 설정 버튼을 누르면 헤더 메뉴가 즉시 전환되어 사용자 흐름이 직관적으로 바뀌고, 구성원/직책 영역의 텍스트도 한국어로 정상 표시된다.

## 작업 로그 (2025-12-10-07)
- 계획: 직책 기본값(대표/관리자/직원)과 계층 정보를 시스템에서 관리하고, 설정 화면에서 직책 목록/편집/삭제/할당 흐름을 정비.
- 실행: 서버 `tenant_positions` 테이블에 tier/sort_order/is_locked 컬럼을 추가하고, 신규 테넌트 생성 시 대표·관리자·직원 직책을 자동 생성하도록 `position_utils` 헬퍼를 도입했다. 직책 API는 tier/sortOrder/isLocked 정보를 주고받으며 대표 직책은 수정·삭제·배정이 불가하도록 검증했다. Flutter 측에서는 `TenantPosition` 모델을 확장하고 Settings 화면에서 직책 계층/기본 뱃지/드롭다운을 표시하며, 대표·본인의 직책은 수정할 수 없도록 제한했다. 직책 추가/수정 다이얼로그에는 계층 선택을 추가했다.
- 결과: 도매/소매 설정 화면에 기본 직책 세 가지가 항상 보이고, 대표는 기본 직책으로 고정된다. 관리자·직원 직책은 이름을 바꾸거나 삭제/추가할 수 있으며, 구성원 목록에서도 직원만 선택 드롭다운이 노출되어 수직 관계가 명확하게 드러난다.

## 작업 로그 (2025-12-10-08)
- 계획: 기존 도매 업체 가입 실패(항상 신규 모드로 전송)와 직책 카드 한글이 물음표로 깨지는 문제 해결.
- 실행: 판매자 가입 요청 시 `isNew` 값을 폼에서 전달해 기존 회사 선택 시 `mode=existing`이 전송되도록 수정했다. 직책 기본값 생성 유틸과 Flutter 로컬라이제이션(ARB)을 UTF-8 기반 한글 문자열로 정리해 DB/화면 모두 올바른 한글이 저장·표시되도록 했다.
- 결과: 기존 회사 선택 후 제출하면 202(Pending) 응답이 정상적으로 처리되어 "제출되었습니다" 안내가 뜨고, Settings의 직책/안내 문구가 한글로 깔끔하게 표시된다.

## 작업 로그 (2025-12-10-09)
- 계획: 직책 섹션의 한글이 물음표로 깨지는 문제를 고치고, 기존 업체 가입 시 승인요청 대신 "미승인" 직책을 기본 부여하도록 개편.
- 실행: ARB/로컬라이즈드 파일에 직책 관련 문자열을 다시 정의하고, Settings UI가 `미승인` 계층을 포함해 올바른 라벨을 보여주도록 `TenantPositionTier`와 `_tierLabel`을 확장했다. 서버 `position_utils`에는 미승인 기본 직책을 추가하고, 기존 데이터에 ???가 남아 있으면 자동으로 덮어쓰도록 보정 로직을 넣었다. `/auth/register`는 기존 업체 가입 시 membership_requests를 생성하지 않고 곧바로 사용자·멤버십을 만들며, 새 가입자는 자동으로 "미승인" 직책이 배정된다. `/auth/register-buyer`도 기존 매장 가입 시 기본 직책을 미승인으로 부여한다.
- 결과: 직책 카드에 대표/관리자/직원/미승인이 한글로 자연스럽게 표시되고, 기존 업체 가입 사용자도 승인 대기 플로우 없이 바로 로그인하되 미승인 직책으로 권한이 제한된다.
## 작업 로그 (2025-12-11-01)
- 계획: 무역/물류 필드가 포함된 새 스키마에 맞춰 Product 모델과 상세 UI를 확장하고, 더미 데이터/번역을 보강한다.
- 실행: Product에 Incoterm·HS코드·원산지·단위·포장·거래조건·ETA 필드를 추가하고 MockRepository 시드/매퍼를 확장했다. 상품 상세 페이지에 무역/포장/거래조건/ETA 카드와 ‘미입력’ 플레이스홀더를 추가했으며, 영/한 l10n 키를 신규 정의했다.
- 결과: 무역·유통 필드와 포장/CBM/거래조건/ETD·ETA 정보를 UI에서 바로 확인할 수 있고, 새 스키마 필드가 앱 모델과 더미 데이터에 반영되어 후속 API 연동 준비가 완료됐다.
## 작업 로그 (2025-12-11-02)
- 계획: 기존 schema.sql에 무역 확장 컬럼을 통합하고 seed/제품 API가 신규 필드를 주고받도록 정비한다.
- 실행: products 테이블에 incoterm/hs_code/origin_country/uom/is_perishable/packaging/trade_term/eta 컬럼을 추가하고, products API가 JSON 필드를 직렬화/파싱하도록 수정했다. seed.ts에 동일 컬럼을 보강해 포장/거래조건/ETA가 포함된 더미 데이터를 넣도록 변경하고, schema_v2.sql은 삭제했다.
- 결과: 
pm run seed 후 서버가 무역 필드를 포함한 최신 스키마로 초기화되며, 상품 API가 포장·거래조건·ETA 정보를 반환/저장할 준비가 완료됐다.
## 작업 로그 (2025-12-11-03)
- 계획: 새 무역 스키마에 맞춰 대시보드/상품 편집 UI를 확장하고, 시드 데이터를 도매·소매/1년치 주문·50개 상품으로 채운다.
- 실행: 대시보드 스냅샷에 월간 매출/미수금/반품/입고 예정/유통기한 임박/상위 상품·거래처/직원 상태를 추가하고 UI 카드·리스트를 배치했다. 상품 편집 시트에 HS코드/원산지/단위/인코텀즈/포장 스펙/거래조건/ETA 입력 필드를 추가해 저장 시 API로 전달되도록 했다. seed.ts를 도매 2곳(식품/의류)·소매 2곳(마트/의류매장) 구조로 재구성하고, 업체별 50개 상품/12개월 주문 샘플을 생성하며 products API/스키마는 포장·거래조건·ETA JSON 필드를 처리하도록 확장했다.
- 결과: 
pm run seed로 식품/의류 도매와 연결된 소매 데이터가 1년 주문 이력과 함께 채워지며, 앱 대시보드에서 매출·입고·유통기한·상위 매출 지표를 확인할 수 있고 상품 등록/수정 시 무역 정보를 입력·저장할 수 있다.
## 작업 로그 (2025-12-11-04)
- 계획: 대시보드·상품 편집 UI가 실제 DB 데이터만 사용하도록 모의/랜덤 값을 제거하고, 입고/무역 필드를 직접 입력·표시할 수 있게 정비한다.
- 실행: 대시보드 서비스가 주문/제품 API 데이터로만 월간 매출·미수금·반품·상위 상품/거래처·입고 예정 정보를 계산하도록 수정하고, 임의 스태프/유통기한 모의 데이터를 제거했다. 주문 목록 API가 라인아이템을 함께 반환하도록 보강해 상위 지표가 실제 주문/상품으로 집계된다. 상품 편집 시트에서 인코텀즈·포장·거래조건·ETA를 입력해 저장하도록 개선하고, 로컬 헬퍼/Dropdown 경고를 정리했다.
- 결과: 대시보드 카드와 분석 섹션이 현재 DB의 주문/상품/ETA 기반 수치만 노출하며, 입고 예정은 product ETA에서 직접 집계되고 스태프/유통기한이 없으면 표시되지 않는다. 상품 등록/수정 시 무역·입고 정보 입력이 가능해 실제 DB 데이터를 유지·표시할 수 있다.
